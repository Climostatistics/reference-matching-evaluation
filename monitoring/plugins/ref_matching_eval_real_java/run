DIR=$1

cd $DIR

git clone https://github.com/CrossRef/reference-matching-evaluation.git > /dev/null 2>&1
export PYTHONPATH=$DIR/reference-matching-evaluation

git clone https://github.com/CrossRef/search-based-reference-matcher.git > /dev/null 2>&1
cd search-based-reference-matcher/
mvn package > /dev/null
cd ..

mkdir -p results
DATE=$(date +"%Y-%m-%d")
OUTPUT=results/output-$(date +"%Y-%m-%d").json

java -cp $DIR/search-based-reference-matcher/target/reference-matching-jar-with-dependencies.jar org.crossref.refmatching.ReferenceMatcher -i txt -f strings.txt -o $OUTPUT > /dev/null
./run.py dataset.json $OUTPUT

rm -rf $DIR/reference-matching-evaluation $DIR/search-based-reference-matcher
